RSS <- function(parameters) {
names(parameters) <- c("beta", "gamma")
out <- ode(y = init, times = Day, func = SIR, parms = parameters)
fit <- out[, 3]
sum((Infected - fit)^2)
}
Opt <- optim(c(0.5, 0.5),
RSS,
method = "L-BFGS-B",
lower = c(0, 0),
upper = c(1, 1)
)
# check for convergence
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
sir_end_date <- "2020-04-10"
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
View(Infected)
View(Infected)
View(Infected)
View(Infected)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
rmse(infected,fitted_cumulative_incidence$I)
rmse(Infected,fitted_cumulative_incidence$I)
rmse(t(Infected),fitted_cumulative_incidence$I)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
t <- 1:120
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "Texas",
cumulative_incident_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_incident_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, Texas"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
###### Prediciton ######### 60 + days
# time in days for predictions
t <- 1:90
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
##### NEW GRAPH ####
# add a Date column and join the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "Texas",
cumulative_incident_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_incident_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, Texas"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
t <- 1:70
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
##### NEW GRAPH ####
# add a Date column and join the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "Texas",
cumulative_incident_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_incident_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, Texas"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
data=read.csv("new_york.csv")
View(data)
View(data)
sir_start_date <- "2020-03-03"
sir_end_date <- "2020-04-01"
Infected = t(data[42:71,2])
# now specify initial values for N, S, I and R
N <- 20000000 #### Population of Texas
init <- c(
S = N - Infected[1],
I = Infected[1],
R = 0
)
N <- 19450000 #### Population of Texas
init <- c(
S = N - Infected[1],
I = Infected[1],
R = 0
)
init
RSS <- function(parameters) {
names(parameters) <- c("beta", "gamma")
out <- ode(y = init, times = Day, func = SIR, parms = parameters)
fit <- out[, 3]
sum((Infected - fit)^2)
}
Opt <- optim(c(0.5, 0.5),
RSS,
method = "L-BFGS-B",
lower = c(0, 0),
upper = c(1, 1)
)
# check for convergence
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
Opt <- optim(c(0.5, 0.5),
RSS,
method = "L-BFGS-B",
lower = c(0, 0),
upper = c(2, 1)
)
# check for convergence
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
sir_start_date <- "2020-03-03"
sir_end_date <- "2020-04-01"
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
rmse(t(Infected),fitted_cumulative_incidence$I)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
Infected = t(data[42:71,2])
Day <- 1:(length(Infected))
N <- 19450000 #### Population of Texas
init <- c(
S = N - Infected[1],
I = Infected[1],
R = 0
)
RSS <- function(parameters) {
names(parameters) <- c("beta", "gamma")
out <- ode(y = init, times = Day, func = SIR, parms = parameters)
fit <- out[, 3]
sum((Infected - fit)^2)
}
Opt <- optim(c(0.5, 0.5),
RSS,
method = "L-BFGS-B",
lower = c(0, 0),
upper = c(1, 1)
)
# check for convergence
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
rmse(t(Infected),fitted_cumulative_incidence$I)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
# add a Date column and the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state= "New York",
cumulative_incident_cases = t(Infected)
)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state= "New York",
cumulative_cases = t(Infected)
)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
# plot the data
Windows()
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I), colour = "red") +
geom_point(aes(y = cumulative_cases), colour = "blue") +
labs(
y = "Cumulative incidence",
title = "COVID-19 fitted vs observed cumulative incidence, New York",
subtitle = "(Red = fitted from SIR model, blue = observed)"
) +
theme_minimal()
t <- 1:60
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
# add a Date column and join the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "New York",
cumulative_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_incident_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, Texas"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, New York"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
t <- 1:120
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
##### NEW GRAPH ####
# add a Date column and join the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "New York",
cumulative_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, New York"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
t <- 1:120
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = c(0.58,0.2)
))
par2 = c(.58,.2)
par2 <- setNames(par2, c("beta", "gamma"))
t <- 1:120
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = par2
))
View(fitted_cumulative_incidence)
View(fitted_cumulative_incidence)
##### NEW GRAPH ####
# add a Date column and join the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state = "New York",
cumulative_cases = c(Infected, rep(NA, length(t) - length(Infected)))
)
# plot the data
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I, colour = "red")) +
geom_point(aes(y = cumulative_cases,colour = "blue")) +
scale_y_continuous(labels = scales::comma) +
labs(
y = "Persons",
title = "COVID-19 fitted vs observed cumulative cases, New York"
) +
scale_colour_manual(
name = "",
values = c(red = "red", blue = "blue"),
labels = c("Observed", "Forecast")
) +
theme_minimal()
sir_start_date <- "2020-03-02"
sir_end_date <- "2020-05-04"
Infected = t(data[41:104,2])
# now specify initial values for N, S, I and R
N <- 19450000 #### Population of Texas
init <- c(
S = N - Infected[1],
I = Infected[1],
R = 0
)
RSS <- function(parameters) {
names(parameters) <- c("beta", "gamma")
out <- ode(y = init, times = Day, func = SIR, parms = parameters)
fit <- out[, 3]
sum((Infected - fit)^2)
}
Day <- 1:(length(Infected))
# optimised for the best fit to the incidence data
RSS <- function(parameters) {
names(parameters) <- c("beta", "gamma")
out <- ode(y = init, times = Day, func = SIR, parms = parameters)
fit <- out[, 3]
sum((Infected - fit)^2)
}
Opt <- optim(c(0.5, 0.5),
RSS,
method = "L-BFGS-B",
lower = c(0, 0),
upper = c(1, 1)
)
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
rmse(t(Infected),fitted_cumulative_incidence$I)
######### GRAPH #######
# add a Date column and the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state= "New York",
cumulative_cases = t(Infected)
)
# plot the data
Windows()
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I), colour = "red") +
geom_point(aes(y = cumulative_cases), colour = "blue") +
labs(
y = "Cumulative incidence",
title = "COVID-19 fitted vs observed cumulative incidence, New York",
subtitle = "(Red = fitted from SIR model, blue = observed)"
) +
theme_minimal()
Opt <- optim(c(0.5, 0.5),
RSS,
method = "BFGS"
)
#lower = c(0, 0),
#upper = c(1, 1)
# check for convergence
Opt$message
Opt_par <- setNames(Opt$par, c("beta", "gamma"))
Opt_par
t <- 1:as.integer(ymd(sir_end_date) + 1 - ymd(sir_start_date))
# get the fitted values from our SIR model
fitted_cumulative_incidence <- data.frame(ode(
y = init, times = t,
func = SIR, parms = Opt_par
))
rmse(t(Infected),fitted_cumulative_incidence$I)
# add a Date column and the observed incidence data
fitted_cumulative_incidence <- fitted_cumulative_incidence %>%
mutate(
Date = ymd(sir_start_date) + days(t - 1),
state= "New York",
cumulative_cases = t(Infected)
)
# plot the data
Windows()
fitted_cumulative_incidence %>%
ggplot(aes(x = Date)) +
geom_line(aes(y = I), colour = "red") +
geom_point(aes(y = cumulative_cases), colour = "blue") +
labs(
y = "Cumulative incidence",
title = "COVID-19 fitted vs observed cumulative incidence, New York",
subtitle = "(Red = fitted from SIR model, blue = observed)"
) +
theme_minimal()
library(gamlr)
data=read.csv("covid2.csv")
View(data)
x<- data[-c(1,2,3,5)]
n = nrow(x)
n_train = round(0.8*n)  # round to nearest integer
n_test = n - n_train
train_cases = sample.int(n, n_train, replace=FALSE)
test_cases = setdiff(1:n, train_cases)
x_train = x[train_cases,]
x_test = x[test_cases,]
View(x_train)
View(x_train)
m1 = randomForest(cases ~ .,data = x_train, mtry = 5, ntree=1000)
yhat_test = predict(m1, x_test)
rmse(x_test$deaths,yhat_test)
rmse(x_test$deaths,yhat_test)
View(x_train)
View(x_train)
rmse(x_test$cases,yhat_test)
compare=c(x_test$cases,yhat_test)
compare=cbind(x_test$cases,yhat_test)
View(compare)
View(compare)
View(compare)
View(compare)
varImpPlot(m1,type=2)
varImp(m1)
varImp(m1) %>% arrange
varImp(m1) %>% arrange()
varImp(m1) %>% sort()
sort(varImp(m1))
varimp=as.data.frame(varImp(m1))
View(varimp)
View(varimp)
rmse(x_test$cases,yhat_test)
